"""
Simple Calendar App - Final Working Version
"""

import json
import datetime
from dataclasses import dataclass
from typing import List, Dict

@dataclass
class Event:
    id: str
    title: str
    date: str
    time: str
    description: str

class MyCalendar:
    def __init__(self):
        self.events = {}
        self.filename = "events.json"
        self.load_events()
    
    def load_events(self):
        try:
            with open(self.filename, 'r') as f:
                events_data = json.load(f)
                for event_data in events_data:
                    self.events[event_data['id']] = Event(**event_data)
            print(f"Loaded {len(self.events)} events")
        except (FileNotFoundError, json.JSONDecodeError):
            print("Starting with empty calendar")
    
    def save_events(self):
        events_list = [event.__dict__ for event in self.events.values()]
        with open(self.filename, 'w') as f:
            json.dump(events_list, f, indent=2)
    
    def create_event(self, title, date, time, description):
        event_id = f"event{len(self.events) + 1}"
        event = Event(event_id, title, date, time, description)
        self.events[event_id] = event
        self.save_events()
        return event_id
    
    def get_events(self):
        return list(self.events.values())
    
    def delete_event(self, event_id):
        if event_id in self.events:
            del self.events[event_id]
            self.save_events()
            return True
        return False

class EventPredictor:
    def predict_category(self, title):
        title_lower = title.lower()
        if any(word in title_lower for word in ['meeting', 'work', 'project']):
            return "Work"
        elif any(word in title_lower for word in ['lunch', 'dinner', 'party']):
            return "Social"
        elif any(word in title_lower for word in ['doctor', 'exercise', 'gym']):
            return "Health"
        else:
            return "Personal"
    
    def predict_priority(self, title):
        title_lower = title.lower()
        if any(word in title_lower for word in ['urgent', 'important', 'deadline']):
            return "High"
        elif any(word in title_lower for word in ['review', 'discussion']):
            return "Medium"
        else:
            return "Low"

def validate_date(date_str):
    """Validate date format without using strptime"""
    try:
        parts = date_str.split('-')
        if len(parts) != 3:
            return False
        year, month, day = int(parts[0]), int(parts[1]), int(parts[2])
        # Basic validation
        return (1 <= month <= 12 and 1 <= day <= 31 and year >= 2024)
    except:
        return False

def validate_time(time_str):
    """Validate time format without using strptime"""
    try:
        parts = time_str.split(':')
        if len(parts) != 2:
            return False
        hour, minute = int(parts[0]), int(parts[1])
        return (0 <= hour <= 23 and 0 <= minute <= 59)
    except:
        return False

def display_menu():
    print("\n=== SIMPLE CALENDAR ===")
    print("1. Add Event")
    print("2. View Events")
    print("3. Delete Event")
    print("4. AI Predictions")
    print("5. Show Calendar View")
    print("6. Exit")
    return input("Choose option (1-6): ").strip()

def show_calendar_view(events):
    """Simple calendar visualization"""
    print("\n--- CALENDAR VIEW ---")
    
    # Group events by month
    events_by_month = {}
    for event in events:
        month_key = event.date[:7]  # YYYY-MM
        if month_key not in events_by_month:
            events_by_month[month_key] = []
        events_by_month[month_key].append(event)
    
    for month, month_events in events_by_month.items():
        print(f"\n{month}:")
        for event in month_events:
            print(f"  {event.date} {event.time} - {event.title}")

def main():
    calendar = MyCalendar()
    predictor = EventPredictor()
    
    while True:
        choice = display_menu()
        
        if choice == '1':
            print("\n--- ADD EVENT ---")
            title = input("Event title: ").strip()
            if not title:
                print("Title cannot be empty!")
                continue
                
            date = input("Date (YYYY-MM-DD): ").strip()
            if not validate_date(date):
                print("Invalid date format! Use YYYY-MM-DD")
                continue
                
            time = input("Time (HH:MM): ").strip()
            if not validate_time(time):
                print("Invalid time format! Use HH:MM")
                continue
                
            description = input("Description: ").strip()
            
            event_id = calendar.create_event(title, date, time, description)
            print(f"âœ… Event created! ID: {event_id}")
        
        elif choice == '2':
            print("\n--- ALL EVENTS ---")
            events = calendar.get_events()
            if not events:
                print("No events found")
            else:
                for event in events:
                    print(f"\nðŸ“… ID: {event.id}")
                    print(f"   Title: {event.title}")
                    print(f"   Date: {event.date} at {event.time}")
                    print(f"   Description: {event.description}")
        
        elif choice == '3':
            print("\n--- DELETE EVENT ---")
            events = calendar.get_events()
            if not events:
                print("No events to delete")
                continue
                
            print("Current events:")
            for event in events:
                print(f"  {event.id}: {event.title}")
                
            event_id = input("Enter event ID to delete: ").strip()
            if calendar.delete_event(event_id):
                print("âœ… Event deleted!")
            else:
                print("âŒ Event not found!")
        
        elif choice == '4':
            print("\n--- AI PREDICTIONS ---")
            title = input("Enter event title for prediction: ").strip()
            if not title:
                print("Title cannot be empty!")
                continue
                
            category = predictor.predict_category(title)
            priority = predictor.predict_priority(title)
            print(f"\nðŸ¤– Predictions for '{title}':")
            print(f"   Category: {category}")
            print(f"   Priority: {priority}")
        
        elif choice == '5':
            events = calendar.get_events()
            show_calendar_view(events)
        
        elif choice == '6':
            print("Goodbye! ðŸ‘‹")
            break
        
        else:
            print("âŒ Invalid choice! Please enter 1-6")

if __name__ == "__main__":
    main()

